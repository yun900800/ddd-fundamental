# 这就是搜索引擎读书笔记
1. 技术名词:
    - 倒排索引,检索模型,爬虫
    - 链接分析,网页反作弊,用户搜索意图分析,云存储,网页去重,搜索引擎缓存
    - 少公式,多例子,多画图
2. 理解如何从文档集合中构建倒排索引,主要有三种方式,说出每种方式的优缺点：
    - 两遍文档遍历法,第一遍统计信息,第二遍填充倒排列表,适用于小文档集合(都在内存构建),大文档集合内存可能不够
    - 排序法,需要在内存(大小规定,词典越多,可归并越少)和磁盘操作,词典一直在内存操作,
    三元组(中间结果内存排序)在磁盘和内存之间归并(归并的时候需要处理不同缓冲区,因为单词可能在多个缓冲区)构建倒排列表。
    - 归并法,是将词典也会写到磁盘,与排序法的差别是这个在内存中建立了子集文档的索引;而排序法中词典与三元组没啥关系
3. 如何构建动态索引,需要三个关键索引：临时索引对应新增加的文档,倒排索引对应已经构建文档,已删除文档列表对应查询过滤

4. 更新索引的几种方法,更新的原因是内存中的临时索引会越来越大，导致内存不够,所以需要更新到磁盘
    - 完全重建策略,就是对所有文档进行重建，重建完成后，使用新的索引提供服务
    - 再合并策略,有一点理解上的问题,因此会将老索引写到新的索引中,因此合并还是很耗时,有一个好处是
   因为有序，所以合并效率高，类似于合并两个有序列表
    - 原地更新策略,说人话就是老索引预留一定的空间,新索引直接插进去;空间足够直接插,空间不够找一个最够空间复制以后再插入
   还增加了映射信息,本来有序变得无序;迁移常见就涉及磁盘管理，反而增加了负担
    - 混合策略;长倒排原地更新,短倒排合并
5. 查询处理有哪些机制
    - 一次一文档,在单词文档矩阵中,先纵向再横向
    - 一次一单词,在单词文档矩阵中,先横向再纵向
6. 为什么会用到跳跃指针?它的作用是什么

7. 常用elastic常用链接:https://www.jianshu.com/p/d6acaceffa8a;https://blog.csdn.net/laoyang360/category_9266239.html
8. 出现多字段索引的原因是:不同的字段有不同的权重,比如关键词在标题肯定比在正文的权重更高
   - 多索引方式,就是为每个字段建立索引,比如为标题,摘要，正文建立索引
   - 倒排列表方式 搜索引擎--->[1:2:"001"] [3:3:"101"] [4:5:"111"] 倒排索引最后101对应标题,摘要，正文是否存在1存在0不存在
   - 扩展列表方式
9. 为什么会有短语查询?比如"你懂的"、"懂你的",支持短语查询主要有三种方法:
   - 位置信息索引 (文档id:单词频率:单词位置信息) 爱情---> <5,2,[3,7]> <7,3,[2,8,10]> <9,2,[1,5]>
   买卖 ---> <5,1,[4]> <6,2,[4,6]> <9,3,[3,9,15]> 这里返回5号文档
   - 双词索引 就是为首词和下词建立词典,并为这个短语建立索引,这时候词典信息会翻倍甚至更多。
   - 短语索引 就是在词典中加入短语,并为短语设计倒排列表,挖掘热门短语成为一项工作;有了短语索引,
   先使用短语索引，否则使用常规索引
   - 混合方法,每种索引有每种索引的优势，比如位置索引适合处理常规短语;双词索引适合处理计算代价较高的短语;
   而短语索引适合处理高频词或者热频词,可以根据具体情况来混合处理

10. 为什么要使用分布式索引?主要解决什么问题?首先，文档太多导致单台机器不能处理,因此需要分布式处理,主要包括两种方案:
    - 按文档对索引划分 将文档划分成若干个子集,每台机器对子集建立索引,并响应查询请求;
    查询服务器分发给各索引服务器,取出得分最高的K个文档返回（这个适用于大众场合）
    - 按单词对索引划分 将不同的单词分发到各个不同的索引服务器(这个适用于特殊场合)

11. 为什么会有索引压缩以及有哪些压缩算法?
    索引数据量大，比如有些常见单词的索引会有几百兆;磁盘读写速度慢,会成为瓶颈;用户查询关键字包含常见词,响应速度会受到严重影响.
    因此需要索引压缩。优化磁盘空间,减少磁盘读写量,加快响应速度
    因为索引包括词典和词典对应的倒排列表,索引压缩主要从这两方面入手
12. 针对词典的压缩和针对倒排列表的压缩有啥区别?
    首先词典的组织方式有hash和B树;首先词典的值组织形式(词典值(20):文档频率(4):倒排指针地址(4)),第一步,词典值优化
    (词典值(4):文档频率(4):倒排指针地址(4)),这里词典值存储地址啦。更好的方法是将词典的值分块存储,这样只需要一个地址，不过
    词典的值需要记录每块数据中各单词的长度
13. 针对倒排列表的压缩有哪些算法?
    首先我们看看倒排列表数据结构(文档编号:单词频率:单词位置信息);对文档编号可以采用差值存储;
    压缩好坏有三个指标:压缩率,压缩速度和解压速度
14. 什么是一元编码和二进制编码?

15. 什么是检索模型,它的作用是什么?如何使用检索模型来对结果进行排序?
    首先模型的作用是判断用户查询关键词与网页相关性进行打分,主要的模型有布尔模型,向量空间模型,概率模型和语言模型
16. 什么是好的检索模型?如何根据四象限法则判断检索模型的好坏?
    首先需要理解的是四象限包含两个维度:是否包含关键词,是否相关文档;因此可以推出好的模型是提升一二象限，抑制三四象限
17. 布尔模型的核心就是布尔代数运算,向量空间模型其实就是对文档提取出若干特征，构成一个n维的向量,而特征的定义是不同的,可以是单词，词组
    N-gram片段,每个特征有一个权重,从而每个文档构成一个向量;将特征转化为向量之后,计算向量之间的夹角,从而判断相似性;另外
    一个问题是特征权重是如何计算?其实就是TF/IDF模型;TF是词频,IDF是逆文档频率;概率模型,语言模型比较复杂，
    机器学习排序也是,暂时先过
18. 链接分析解决的是什么问题?主要解决的问题是网页的重要性问题.
    PageRank算法的基本思路是什么?主要的参数包括页面的数量和页面的质量。什么是链接陷阱，如何解决这个问题?
    HITS算法的基本假设是什么?什么是Hub页面?什么是Authority页面

19. es和关系数据库最大的区别是:es面向的是文档(它存储,索引,检索,排序,过滤文档),而关系数据库面向的行列数据;理解es中索引作为名词和动词的时候,
    它们的意义有什么区别?倒排索引和B+树索引对于文档搜索和关系数据库搜索过滤有啥作用?

20. GET检索和_search检索有什么区别?似乎GET出来的数据没有打分,而search出来的数据有一个分数的概念;
    查询表达式和query-string的区别是什么,适应的场景又是什么?全文检索中,为什么需要相关性的概念.

21. 什么是短语搜索?match_phrase的使用场景是什么?什么是高亮搜索?它的使用场景是什么?

22. 为什么会出现聚合,其实是对文档数据进行分析.

23. elastic-search 集群的一些基本概念:
    - 什么是集群?什么是节点?什么是分片?什么是副本?
    - es的扩容机制是什么?
    - 如何处理硬件故障?
    - 失效切换的基本原理是什么?
    - 垂直扩容和水平扩容是什么意思?为什么垂直扩容的潜力是有限的?而水平扩容能降低负载压力?
    - 下面用一个例子来串起这些概念,首先提出来两个问题?
    新增节点的情况:我的群集具有黄色运行状况，因为它只有一个节点，因此副本保持未分配状态，我想要添加一个节点，该怎么弄？
    删除节点的情况:假设集群中有5个节点，我必须在运行时删除2个节点。那么如何在不影响指数的情况下完成？
    我有接近10 Gb/hour的连续数据流，这些数据正在连续写入并索引化。重新平衡会对此有所影响吗？
    - 针对上面的情况,需要理解下面的知识点:
    Master节点的职责:
        - 确定将哪些分片分配给哪些节点,以及何时在节点之间移动分片以重新平衡集群
        - 还有就是集群增加,删除索引或者增加,删除节点,不涉及文档级别的变更和搜索
        - 任何节点都可以成为主节点,集群中每个节点都知道具体文档的位置
    分片分配发生的时机:
        - 分片分配是将分片分配给节点的过程;这可能发生在集群初始恢复,副本分配,重新平衡,添加或删除节点期间
    控制分配/重新平衡分片操作的常见设置
        - cluster.routing.allocation.enable
        - cluster.routing.rebalance.enable
        - cluster.routing.allocation.balance.shard
        - cluster.routing.allocation.balance.index
        - cluster.routing.allocation.balance.threshold
    基于磁盘的分片分配
        - cluster.routing.allocation.disk.watermark.low
        - cluster.routing.allocation.disk.watermark.high
        - cluster.routing.allocation.disk.watermark.flood_stage
        - cluster.info.update.interval
    索引/节点层面的分片分配(索引是指向一个或多个物理分片的逻辑命名空间,同时一个分片是一个Lucene实例)
        - cluster.routing.allocation.include.{attribute}——至少包含
        - cluster.routing.allocation.require.{attribute}——全部包含
        - cluster.routing.allocation.exclude.{attribute}——非、排除操作
    - 什么是主分片,什么是副本分片?为什么主分片的数量决定了索引的容量?一个主分片的最大容量是多大?
    副本分片作为保护数据不丢失的冗余备份,同时为搜索提供读服务;需要注意的一点是索引建立的时候就要确定主分片的数目,
    而副本分片的数目可以随时修改